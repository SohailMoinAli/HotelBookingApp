@model IEnumerable<HotelBookingApp.Models.Room>

<h2>Book a Room</h2>

<ul>
    @foreach (var room in Model)
    {
        <li>
            Room Number: @room.Number, Type: @room.Type, Price: $@room.Price.ToString("F2")
            <form asp-action="BookARoom" asp-controller="Rooms" method="post">
                <input type="hidden" name="roomId" value="@room.RoomId" />
                <input type="date" name="checkInDate" class="date-input" data-room-id="@room.RoomId" data-price="@room.Price" required placeholder="Check-in Date" />
                <input type="date" name="checkOutDate" class="date-input" data-room-id="@room.RoomId" required placeholder="Check-out Date" />
                <div id="duration-@room.RoomId">Duration: 0 Nights</div>
                <div id="total-price-@room.RoomId">Total Price: $0.00</div>
                <input type="submit" value="Book Now" />
            </form>
        </li>
    }
</ul>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var dateInputs = document.querySelectorAll('.date-input');
        dateInputs.forEach(function (input) {
            input.addEventListener('change', function () {
                var roomId = this.dataset.roomId;
                var pricePerNight = parseFloat(this.dataset.price);
                var checkInInput = document.querySelector('input[name="checkInDate"][data-room-id="' + roomId + '"]');
                var checkOutInput = document.querySelector('input[name="checkOutDate"][data-room-id="' + roomId + '"]');

                if (checkInInput.value && checkOutInput.value) {
                    var checkInDate = new Date(checkInInput.value);
                    var checkOutDate = new Date(checkOutInput.value);
                    var duration = Math.round((checkOutDate - checkInDate) / (1000 * 3600 * 24)); // Difference in days

                    if (duration > 0) {
                        document.getElementById('duration-' + roomId).innerText = 'Duration: ' + duration + ' Nights';
                        document.getElementById('total-price-' + roomId).innerText = 'Total Price: $' + (pricePerNight * duration).toFixed(2);
                    } else {
                        document.getElementById('duration-' + roomId).innerText = 'Duration: 0 Nights';
                        document.getElementById('total-price-' + roomId).innerText = 'Total Price: $0.00';
                    }
                }
            });
        });
    });
</script>
